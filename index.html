<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ•¸å­—ä¸­ç¿»è‹±ç·´ç¿’</title>
</head>
<body>
  <h1>æ•¸å­—ä¸­ç¿»è‹±ç·´ç¿’</h1>
  <button onclick="playAudio()">ğŸ”Š æ’­æ”¾è‹±æ–‡èªéŸ³</button>
  <button id="speechBtn" onclick="startSpeechRecognition()">ğŸ¤ èªéŸ³è¼¸å…¥</button>
  <button id="stopBtn" onclick="stopSpeechRecognition()" style="display:none;">ğŸ›‘ åœæ­¢éŒ„éŸ³</button>
  <p id="speechOutput"></p>
  <audio id="userRecording" controls style="display:none;"></audio>
  <a id="downloadLink" style="display:none;" download="recording.webm">â¬‡ï¸ ä¸‹è¼‰ä½ çš„ç™¼éŸ³éŒ„éŸ³</a>

  <script>
let naturalVoice = null;
speechSynthesis.onvoiceschanged = () => {
  const voices = speechSynthesis.getVoices();
  naturalVoice = voices.find(v => /Google UK English Female|Microsoft Aria|en-US/i.test(v.name)) || voices[0];
};

function playAudio() {
  const utter = new SpeechSynthesisUtterance("three million sixty-five thousand two hundred seventy-eight");
  if (naturalVoice) utter.voice = naturalVoice;
  speechSynthesis.speak(utter);
}

let recognition = null, mediaRecorder = null;

function stopSpeechRecognition() {
  if (recognition) recognition.abort();
  if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
  document.getElementById('speechOutput').textContent = "â¹ï¸ å·²åœæ­¢éŒ„éŸ³";
  document.getElementById('stopBtn').style.display = 'none';
  document.getElementById('speechBtn').disabled = false;
}

function startSpeechRecognition() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ã€‚");
    return;
  }
  recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  const output = document.getElementById('speechOutput');
  const btn = document.getElementById('speechBtn');
  output.classList.add('listening');
  output.textContent = "ğŸ™ï¸ æ­£åœ¨è†è½...";
  btn.disabled = true;
  document.getElementById('stopBtn').style.display = 'inline-block';

  navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
    const audioChunks = [];
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
      const audioUrl = URL.createObjectURL(audioBlob);
      const audio = document.getElementById('userRecording');
      audio.src = audioUrl;
      audio.style.display = 'block';
      const download = document.getElementById('downloadLink');
      download.href = audioUrl;
      download.style.display = 'inline';
      download.download = `recording_${Date.now()}.webm`;
    };
    mediaRecorder.start();
    setTimeout(() => {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
      }
    }, 10000); // default 10s
    recognition.start();
  });

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    output.textContent = `ä½ èªªçš„æ˜¯ï¼šã€Œ${transcript}ã€`;
  };

  recognition.onerror = function(event) {
    output.textContent = "âŒ èªéŸ³è¾¨è­˜éŒ¯èª¤: " + event.error;
  };

  recognition.onend = function() {
    output.classList.remove('listening');
    btn.disabled = false;
    document.getElementById('stopBtn').style.display = 'none';
  };
}
  </script>
</body>
</html>
